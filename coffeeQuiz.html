<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BeanWay | Coffee Mood Quiz</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{
      --bg:#F4F1EC; --text:#124D43; --text2:#2F7566; --brown:#4a3b28;
      --paper:#FFFFFF; --shadow:rgba(0,0,0,.12);
      --btn:#D2B48C; --btn-hover:#C2A475;
    }
    *{margin:0;padding:0;box-sizing:border-box;line-height:1.7}
    body{background:var(--bg);color:var(--text);font-family:"Poppins",sans-serif}

    /* Header */
    header{
      width:100%; background-color:rgba(244,241,236,0.95);
      box-shadow:0 2px 10px rgba(0,0,0,.1); z-index:10; position:relative;
      display:flex; justify-content:center;
    }
    .nav-container{max-width:1100px; width:100%; display:flex; justify-content:space-between; align-items:center; padding:15px 40px}
    .nav-left a{color:var(--text); text-decoration:none; margin-right:25px; font-family:"Playfair Display",serif; font-size:17px}
    .nav-left a:hover{color:var(--text2)}
    .nav-center img{height:45px; display:block; margin:0 auto 5px}
    .nav-center h1{font-family:"Playfair Display",serif; font-size:26px; color:var(--text)}
    .nav-right img{height:32px;width:32px;cursor:pointer}

    /* Quiz container */
    .quiz-wrap{max-width:820px; margin:48px auto; padding:0 20px}
    .quiz-card{background:var(--paper); border-radius:14px; box-shadow:0 6px 18px var(--shadow); overflow:hidden}
    .quiz-header{padding:28px 32px; text-align:center}
    .quiz-header h2{font-family:"Playfair Display",serif; font-size:26px; margin-bottom:8px}
    .quiz-header p{color:#6b5a46}

    .quiz-body{padding:22px 30px}
    .progress{height:8px; background:#efe7db; border-radius:999px; overflow:hidden; margin-bottom:18px}
    .progress > i{display:block; height:100%; width:0%; background:var(--btn); transition:width .35s ease}

    .question{display:none; animation:fadeIn .35s ease}
    .question.active{display:block}
    .q-text{font-weight:600; margin-bottom:14px}
    .options{display:flex; flex-direction:column; gap:12px}
    .option-btn{background:#fff; border:1px solid #E6D7C3; padding:12px 14px; border-radius:10px; cursor:pointer; text-align:left; font-weight:600}
    .option-btn:hover{transform:translateY(-3px); box-shadow:0 6px 14px rgba(0,0,0,0.06)}

    .nav-controls{display:flex; justify-content:space-between; align-items:center; margin-top:18px}
    .btn{background:var(--btn); color:var(--brown); padding:.7rem 1.1rem; border:0; border-radius:10px; font-weight:700; cursor:pointer}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    @keyframes fadeIn{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}

    /* Result */
    .result{display:none; padding:24px 30px; text-align:center}
    .result.active{display:block}
    .result h3{font-family:"Playfair Display",serif; color:var(--text2); margin-bottom:10px}
    .result p{color:#4a3b28; font-size:16px; margin-bottom:16px}
    .result .type-badge{display:inline-block; padding:8px 14px; border-radius:999px; background:#f1e6d6; color:var(--brown); font-weight:700}

    footer{background-color:#0E3D34; color:#F4F1EC; text-align:center; padding:20px 10px; margin-top:36px}
    footer::before{content:""; display:block; width:60%; margin:0 auto 10px auto; border-top:1px solid #FFFFFF; opacity:.8}

    @media (max-width:640px){ .quiz-body{padding:18px} .nav-container{padding:12px 18px} }
  </style>
</head>
<body>
  <header>
    <div class="nav-container">
      <nav class="nav-left">
        <a href="beans.html">Coffee Beans</a>
        <a href="recipes.html">Recipes</a>
        <a href="Brewing.html">Brewing</a>
      </nav>
      <div class="nav-center">
        <img src="images/Logo.png" alt="BeanWay Logo">
        <a href="homepage.html"><h1>BeanWay</h1></a>
      </div>
      <div class="nav-right">
        <a href="login.html" title="Login"><img src="images/login-icon.png" alt="Login"></a>
      </div>
    </div>
  </header>

  <div class="quiz-wrap">
    <div class="quiz-card">
      <div class="quiz-header">
        <h2>What coffee are you in the mood for?</h2>
        <p>Answer a few quick questions about how you feel right now — we'll suggest a coffee type to match your mood.</p>
      </div>

      <div class="quiz-body">
        <div class="progress" aria-hidden><i id="progress-bar"></i></div>

        <!-- Q1: Vibe -->
        <div class="question active" data-q="1">
          <div class="q-text">1. What kind of vibe are you in today?</div>
          <div class="options">
            <button class="option-btn" data-types="espresso,americano">"I need something to <strong>wake me up</strong>."</button>
            <button class="option-btn" data-types="latte">"I want something <strong>comforting and warm</strong>."</button>
            <button class="option-btn" data-types="mocha">"I'm craving something <strong>sweet and cozy</strong>."</button>
            <button class="option-btn" data-types="iced">"Something <strong>refreshing or chilled</strong> sounds nice."</button>
          </div>
        </div>

        <!-- Q2: Weather -->
        <div class="question" data-q="2">
          <div class="q-text">2. What’s the weather like (or how does it feel around you)?</div>
          <div class="options">
            <button class="option-btn" data-types="iced" data-weather="iced">"Hot — I need to cool down."</button>
            <button class="option-btn" data-types="latte,mocha,cappuccino" data-weather="warm">"Cold or rainy — something warm would be perfect."</button>
            <button class="option-btn" data-types="espresso,americano" data-weather="neutral">"Neutral — I just want energy."</button>
          </div>
        </div>

        <!-- Q3: Experience (Option A) -->
        <div class="question" data-q="3">
          <div class="q-text">3. What kind of coffee experience do you want right now?</div>
          <div class="options">
            <button class="option-btn" data-types="espresso,americano" data-experience="simple">"Quick and simple — just caffeine."</button>
            <button class="option-btn" data-types="latte,cappuccino" data-experience="cozy">"Calm and cozy — something to sip slowly."</button>
            <button class="option-btn" data-types="mocha,iced" data-experience="treat">"Fun and indulgent — something that feels like a treat."</button>
          </div>
        </div>

        <!-- Q4: Intensity -->
        <div class="question" data-q="4">
          <div class="q-text">4. How intense do you want your coffee flavor to be?</div>
          <div class="options">
            <button class="option-btn" data-types="espresso,americano">"Strong and bold."</button>
            <button class="option-btn" data-types="latte,cappuccino">"Mild and smooth."</button>
            <button class="option-btn" data-types="iced">"Light and chilled."</button>
            <button class="option-btn" data-types="mocha">"Sweet and rich."</button>
          </div>
        </div>

        <!-- Q5: Activity -->
        <div class="question" data-q="5">
          <div class="q-text">5. What’s your current activity?</div>
          <div class="options">
            <button class="option-btn" data-types="espresso,americano">"Working or studying — need focus."</button>
            <button class="option-btn" data-types="latte,cappuccino">"Relaxing — maybe watching something or chatting."</button>
            <button class="option-btn" data-types="iced">"Out and about — on the move."</button>
            <button class="option-btn" data-types="mocha">"Treating myself — dessert time."</button>
          </div>
        </div>

        <!-- Q6: After feeling -->
        <div class="question" data-q="6">
          <div class="q-text">6. How do you want to feel <em>after</em> your coffee?</div>
          <div class="options">
            <button class="option-btn" data-types="espresso,americano">"Energized and ready to go."</button>
            <button class="option-btn" data-types="latte">"Relaxed and content."</button>
            <button class="option-btn" data-types="iced">"Refreshed and cool."</button>
            <button class="option-btn" data-types="mocha,cappuccino">"Satisfied and happy."</button>
          </div>
        </div>

        <!-- Result -->
        <div class="result" id="result">
          <h3>Your coffee match</h3>
          <div class="type-badge" id="result-type">—</div>
          <p id="result-desc"></p>
          <div style="margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap">
            <button class="btn" id="try-again">Try Again</button>
            <a href="recipes.html" class="btn" id="view-recipes">See Recipes</a>
          </div>
        </div>

        <div class="nav-controls">
          <button class="btn" id="back-btn" disabled><i class="fa-solid fa-arrow-left"></i> Back</button>
          <div style="width:12px"></div>
          <button class="btn" id="next-fake" style="visibility:hidden">Next</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="copy">© 2025 BeanWay Coffee. All Rights Reserved.</div>
  </footer>

  <script>
    // Quiz logic
    const questions = Array.from(document.querySelectorAll('.question'));
    const progressBar = document.getElementById('progress-bar');
    const resultEl = document.getElementById('result');
    const resultTypeEl = document.getElementById('result-type');
    const resultDescEl = document.getElementById('result-desc');
    const tryAgain = document.getElementById('try-again');
    const viewRecipes = document.getElementById('view-recipes');

    let index = 0;
    let scores = { espresso:0, americano:0, latte:0, cappuccino:0, mocha:0, iced:0 };
    let weatherAnswer = null; // for tie-breaker
    let experienceAnswer = null; // for tie-breaker

    function updateProgress(){
      const pct = Math.round((index) / questions.length * 100);
      progressBar.style.width = pct + '%';
    }

    // attach handlers to options
    document.querySelectorAll('.option-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        // increment scores for all types in data-types
        const types = btn.dataset.types.split(',').map(t=>t.trim()).filter(Boolean);
        types.forEach(t => { if(scores.hasOwnProperty(t)) scores[t] += 1; });

        // capture weather & experience answers for tie-breakers if present
        if(btn.dataset.weather) weatherAnswer = btn.dataset.weather;
        if(btn.dataset.experience) experienceAnswer = btn.dataset.experience;

        // move to next question
        questions[index].classList.remove('active');
        index++;
        if(index < questions.length){
          questions[index].classList.add('active');
          updateProgress();
        } else {
          // show result
          progressBar.style.width = '100%';
          showResult();
        }

      });
    });

    // Back button allows going back to previous question to change answer
    const backBtn = document.getElementById('back-btn');
    backBtn.addEventListener('click', ()=>{
      if(index === 0) return;
      // go back one question
      // We can't perfectly remove which option was clicked previously without storing history.
      // To allow simple back functionality, we'll reload the quiz (safer) — but to be user-friendly,
      // we store a history of the chosen types per question so we can decrement.
    });

    // Implement choice history to enable back functionality
    const choiceHistory = []; // array of arrays of types chosen per question

    // To support history we need to override previous event listeners and recreate
    function setupOptionsWithHistory(){
      // remove existing listeners by cloning
      document.querySelectorAll('.option-btn').forEach(btn => {
        const newBtn = btn.cloneNode(true);
        btn.parentNode.replaceChild(newBtn, btn);
      });

      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const types = btn.dataset.types.split(',').map(t=>t.trim()).filter(Boolean);
          // add to history
          choiceHistory[index] = types;
          // add scores
          types.forEach(t => { if(scores.hasOwnProperty(t)) scores[t] += 1; });

          if(btn.dataset.weather) weatherAnswer = btn.dataset.weather;
          if(btn.dataset.experience) experienceAnswer = btn.dataset.experience;

          questions[index].classList.remove('active');
          index++;
          if(index < questions.length){
            questions[index].classList.add('active');
            updateProgress();
            backBtn.disabled = false;
          } else {
            progressBar.style.width = '100%';
            showResult();
          }
        });
      });
    }

    setupOptionsWithHistory();

    // Now implement a proper back button using history
    backBtn.addEventListener('click', ()=>{
      if(index === 0) return;
      // if result is showing, hide it and restore last question
      if(index >= questions.length){
        resultEl.classList.remove('active');
        // restore last question index to last question index
        index = questions.length - 1;
        // subtract all history scores
      }

      // decrement index and subtract the last choice's scores
      const lastIndex = index - 1;
      if(lastIndex >= 0 && choiceHistory[lastIndex]){
        const lastTypes = choiceHistory[lastIndex];
        lastTypes.forEach(t => { if(scores.hasOwnProperty(t)) scores[t] -= 1; });
        // remove captured weather/experience if they were from that choice
        // (simple approach: if the choice had data-weather/experience attributes, clear them)
        // we stored weather/experience only when chosen, so if the undone choice included them, clear
        // but we don't track per-choice meta deeply — acceptable tradeoff for this quiz.
      }

      // hide current question and show previous
      if(index > 0) questions[index].classList.remove('active');
      index--;
      questions[index].classList.add('active');
      updateProgress();

      if(index === 0) backBtn.disabled = true;
    });

    // Show result function with tie-breaker
    function showResult(){
      // find max score
      const entries = Object.entries(scores);
      entries.sort((a,b)=>b[1]-a[1]);
      const topScore = entries[0][1];
      const tied = entries.filter(e=>e[1]===topScore).map(e=>e[0]);

      let chosen = null;
      if(tied.length === 1){
        chosen = tied[0];
      } else {
        // tie-breaker 1: weatherAnswer
        if(weatherAnswer){
          // map weatherAnswer to preferred type(s)
          if(weatherAnswer === 'iced' && tied.includes('iced')) chosen = 'iced';
          if(weatherAnswer === 'warm'){
            // prefer latte/cappuccino/mocha in that order
            for(const t of ['latte','cappuccino','mocha']) if(tied.includes(t)){ chosen = t; break; }
          }
          if(weatherAnswer === 'neutral'){
            for(const t of ['espresso','americano']) if(tied.includes(t)){ chosen = t; break; }
          }
        }

        // tie-breaker 2: experienceAnswer
        if(!chosen && experienceAnswer){
          if(experienceAnswer === 'cozy'){
            for(const t of ['latte','cappuccino']) if(tied.includes(t)){ chosen = t; break; }
          }
          if(experienceAnswer === 'treat'){
            for(const t of ['mocha','iced']) if(tied.includes(t)){ chosen = t; break; }
          }
          if(experienceAnswer === 'simple'){
            for(const t of ['espresso','americano']) if(tied.includes(t)){ chosen = t; break; }
          }
        }

        // final fallback: priority order
        if(!chosen){
          const priority = ['latte','cappuccino','mocha','iced','espresso','americano'];
          for(const p of priority){ if(tied.includes(p)){ chosen = p; break; } }
        }
      }

      displayResult(chosen);
    }

    function displayResult(type){
      const descriptions = {
        espresso: 'Espresso — a bold, concentrated shot for quick focus and energy.',
        americano: 'Americano — coffee with a clean, steady strength. Good when you want caffeine without fuss.',
        latte: 'Latte — smooth, creamy, and comforting. Perfect for a relaxed sip.',
        cappuccino: 'Cappuccino — balanced and foamy; a great social, feel-good drink.',
        mocha: 'Mocha — sweet and indulgent. A dessert-like treat in a cup.',
        iced: 'Iced Coffee — refreshing and light; excellent for warm moods or when you\'re on the move.'
      };

      resultTypeEl.textContent = type ? type.charAt(0).toUpperCase() + type.slice(1) : 'Something';
      resultDescEl.textContent = type ? descriptions[type] : 'Can\'t decide — try again with different answers!';
      // link to recipes.html with a query param so recipes page can (optionally) read and filter
      viewRecipes.href = 'recipes.html#' + (type || 'all');

      resultEl.classList.add('active');
      // hide any visible question
      questions.forEach(q=>q.classList.remove('active'));
      index = questions.length; // set index to end
      // enable back button to allow user to go back
      backBtn.disabled = false;
    }

    // try again
    tryAgain.addEventListener('click', ()=>{
      // reset everything
      scores = { espresso:0, americano:0, latte:0, cappuccino:0, mocha:0, iced:0 };
      weatherAnswer = null; experienceAnswer = null; choiceHistory.length = 0;
      resultEl.classList.remove('active');
      index = 0;
      questions.forEach(q=>q.classList.remove('active'));
      questions[0].classList.add('active');
      progressBar.style.width = '0%';
      backBtn.disabled = true;
    });

    // initial state
    updateProgress();
    backBtn.disabled = true;

  </script>
</body>
</html>